document.addEventListener("DOMContentLoaded",(function(){let e=$("#sequence"),t=$("#conversionType"),n=$("#showBaseNames"),i=$("#colorizeSequence"),l=$("#result"),o=$("#error"),r=$("#base-buttons"),c=$("#delete-last"),s=$("#clear-all"),a=$("#copy-results"),A=$("#reset-all"),u=$("#visualizer-container"),C=$("#visualizer-title"),d=$(".amino-acid-tooltip"),h=document.getElementById("sequence-visualizer"),f=h.getContext("2d"),p=["A","T","G","C"],G=["A","U","G","C"],g=["DNA_COMPLEMENT","RNA_COMPLEMENT","DNA_TRANSCRIPT"],U={UUU:"Phenylalanine",UUC:"Phenylalanine",UUA:"Leucine",UUG:"Leucine",CUU:"Leucine",CUC:"Leucine",CUA:"Leucine",CUG:"Leucine",AUU:"Isoleucine",AUC:"Isoleucine",AUA:"Isoleucine",AUG:"Methionine",GUU:"Valine",GUC:"Valine",GUA:"Valine",GUG:"Valine",UCU:"Serine",UCC:"Serine",UCA:"Serine",UCG:"Serine",CCU:"Proline",CCC:"Proline",CCA:"Proline",CCG:"Proline",ACU:"Threonine",ACC:"Threonine",ACA:"Threonine",ACG:"Threonine",GCU:"Alanine",GCC:"Alanine",GCA:"Alanine",GCG:"Alanine",UAU:"Tyrosine",UAC:"Tyrosine",UAA:"Stop",UAG:"Stop",CAU:"Histidine",CAC:"Histidine",CAA:"Glutamine",CAG:"Glutamine",AAU:"Asparagine",AAC:"Asparagine",AAA:"Lysine",AAG:"Lysine",GAU:"Aspartic Acid",GAC:"Aspartic Acid",GAA:"Glutamic Acid",GAG:"Glutamic Acid",UGU:"Cysteine",UGC:"Cysteine",UGA:"Stop",UGG:"Tryptophan",CGU:"Arginine",CGC:"Arginine",CGA:"Arginine",CGG:"Arginine",AGU:"Serine",AGC:"Serine",AGA:"Arginine",AGG:"Arginine",GGU:"Glycine",GGC:"Glycine",GGA:"Glycine",GGG:"Glycine"};function T(e,t){u.hide(),f.clearRect(0,0,h.width,h.height);let n,i=Math.min(40*e.length+40,window.innerWidth-40),l=t.includes("PROTEIN")?150:180,o=window.devicePixelRatio||1;h.style.width=i+"px",h.style.height=l+"px",h.width=i*o,h.height=l*o,f.scale(o,o),n="RNA_PROTEIN"==t?e:"DNA_PROTEIN"==t?S(e):null,t.includes("PROTEIN")?function(e,t,n,i){C.text("Polypeptide Chain Visualization");let l=25,o=60,r=i+l,c=n/2,s={Alanine:"#FF6B6B",Arginine:"#4ECDC4",Asparagine:"#1A936F","Aspartic Acid":"#6A0572",Cysteine:"#FFD166","Glutamic Acid":"#118AB2",Glutamine:"#073B4C",Glycine:"#EF476F",Histidine:"#FFD166",Isoleucine:"#06D6A0",Leucine:"#7209B7",Lysine:"#3A86FF",Methionine:"#FB5607",Phenylalanine:"#8338EC",Proline:"#3A86FF",Serine:"#FF006E",Threonine:"#FFBE0B",Tryptophan:"#8AC926",Tyrosine:"#FF9E00",Valine:"#4361EE"},a=[];for(let t=0;t<e.length;t+=3){let n=e.slice(t,t+3);if(3==n.length){let e=U[n]||"Unknown";if("Stop"==e)break;a.push({codon:n,aminoAcid:e,color:s[e.split(" ")[0]]||"#6C757D",x:r+a.length*o,y:c})}}f.beginPath();for(let e=0;e<a.length-1;e++){let t=a[e],n=a[e+1];f.moveTo(t.x+l,t.y),f.lineTo(n.x-l,n.y)}function A(e){let t=h.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,o=!1;for(let t of a){if(Math.sqrt((n-t.x)**2+(i-t.y)**2)<l){d.text(t.aminoAcid+" ("+t.codon+")").css({left:e.pageX+10,top:e.pageY-30,display:"block"}),o=!0;break}}o||d.hide()}function u(){d.hide()}f.strokeStyle="#495057",f.lineWidth=2,f.stroke(),h.removeEventListener("mousemove",A),h.removeEventListener("mouseout",u),h.addEventListener("mousemove",A),h.addEventListener("mouseout",u);for(let e of a){let{x:t,y:n,color:i,aminoAcid:o}=e;f.beginPath(),f.arc(t,n,l,0,2*Math.PI),f.fillStyle=i,f.fill(),f.strokeStyle="#343A40",f.lineWidth=1,f.stroke();let r=o.substring(0,3);f.fillStyle="#FFFFFF",f.font="bold 12px Noto Sans",f.textAlign="center",f.textBaseline="middle",f.fillText(r,t,n)}}(n,0,l,20):function(e,t,n,i,l){let o=40,r=20,c=i/2;C.text("Antiparallel Strands Visualization"),N(e,l,c-40,o,r,"top",t);let s="";"DNA_COMPLEMENT"==t?s=R(e):"RNA_COMPLEMENT"==t?s=v(e):"DNA_TRANSCRIPT"==t&&(s=S(e));N(s,l,c+40,o,r,"bottom",t);for(let t=0;t<e.length;t++){let e=l+t*o+o/2;f.beginPath(),f.moveTo(e,c-40+r),f.lineTo(e,c+40),f.strokeStyle="#CED4DA",f.lineWidth=1,f.stroke()}f.fillStyle="#6C757D",f.font="12px Noto Sans",f.textAlign="center",f.textBaseline="middle"}(e,t,0,l,20),u.show()}function N(e,t,n,i,l,o,r){let c="top"==o;for(let o=0;o<e.length;o++){let s=t+o*i,a=n,A=e[o];f.fillStyle=m(A,r),f.fillRect(s,a,i,l),f.strokeStyle="#343A40",f.lineWidth=1,f.strokeRect(s,a,i,l),f.fillStyle="#FFFFFF",f.font="bold 14px Noto Sans",f.textAlign="center",f.textBaseline="middle",f.fillText(A,s+i/2,a+l/2),f.beginPath(),f.moveTo(s,a+(c?0:l)),f.lineTo(s+i,a+(c?0:l)),f.strokeStyle="#495057",f.lineWidth=3,f.stroke()}}function m(e,t){return{A:"#FF6B6B",T:"#4ECDC4",U:"#1A936F",G:"#FFD166",C:"#6A0572"}[e]||"#6C757D"}function y(){F();let o=e.val().trim().toUpperCase(),r=t.val(),c=n.is(":checked"),s=i.is(":checked");(function(e,t){F();let n=/^[ATGC]*$/i,i=/^[AUGC]*$/i,o=!0,r="";if(""==e)return l.html(""),!0;"RNA_PROTEIN"==t||"RNA_COMPLEMENT"==t?i.test(e)||(o=!1,r="Invalid RNA sequence. Only A, U, G, C characters are allowed."):n.test(e)||(o=!1,r="Invalid DNA sequence. Only A, T, G, C characters are allowed.");if(!o)return E(r),!1;return!0})(o,r)&&(o?T(o,r):u.hide(),g.includes(r)?function(e,t,n,i){let o=function(e,t){if("DNA_COMPLEMENT"==t)return R(e);if("RNA_COMPLEMENT"==t)return v(e);if("DNA_TRANSCRIPT"==t)return S(e);return""}(e,t),r="<p><strong>"+function(e){return{DNA_COMPLEMENT:"Complement DNA",RNA_COMPLEMENT:"Complement RNA",DNA_TRANSCRIPT:"RNA Transcript"}[e]||""}(t)+":</strong> ";if(i){r+='<span class="sequence-container">';for(let e=0;e<o.length;e++){let t=o[e];r+='<span class="base-'+t.toLowerCase()+'">'+t+"</span>"}r+="</span>"}else r+=o;r+="</p>",n&&(r+="<p><strong> Input Bases:</strong> "+M(e)+"</p>",r+="<p><strong> Output Bases:</strong> "+M(o)+"</p>");l.html(r)}(o,r,c,s):function(e,t,n,i){let o,r,c="";if("RNA_PROTEIN"==t){let t=x(e);o=t.codons,r=t.incomplete}else{let t=x(S(e));o=t.codons,r=t.incomplete}if(o.length>0){c="<table><tr><th>Codon</th><th>tRNA Anticodon</th><th>Amino Acid</th></tr>";for(let e=0;e<o.length;e++){let t=o[e],n=t.codon,l=t.anticodon,r=t.aminoAcid,s=n,a=l;i&&(s=P(n),a=P(l)),c+="<tr><td>"+s+"</td><td>"+a+"</td><td><strong>"+r+"</strong></td></tr>"}c+="</table>",r&&(c+="<p><strong>Incomplete codon:</strong> "+r+"</p>"),n&&(c+="<p><strong>Input Bases:</strong> "+M(e)+"</p>"),l.html(c)}else E("No complete codons found.")}(o,r,c,s),k())}function E(e){o.text(e).fadeIn(200).addClass("error-shake"),setTimeout((function(){o.removeClass("error-shake")}),500),l.hide()}function F(){o.hide().text(""),l.show()}function P(e){let t="";for(let n=0;n<e.length;n++){let i=e[n];t+='<span class="base-'+i.toLowerCase()+'">'+i+"</span>"}return t}function R(e){let t={A:"T",T:"A",C:"G",G:"C"},n="";for(let i=0;i<e.length;i++){let l=e[i];n+=t[l]||l}return n}function v(e){let t={A:"U",U:"A",C:"G",G:"C"},n="";for(let i=0;i<e.length;i++){let l=e[i];n+=t[l]||l}return n}function S(e){let t={A:"U",T:"A",C:"G",G:"C"},n="";for(let i=0;i<e.length;i++){let l=e[i];n+=t[l]||l}return n}function L(e){let t={A:"U",U:"A",G:"C",C:"G"},n="";for(let i=e.length-1;i>=0;i--){let l=e[i];n+=t[l]||l}return n}function x(e){let t=[];for(let n=0;n<e.length;n+=3){let i=e.slice(n,n+3);if(3!=i.length)return{codons:t,incomplete:i};{let e=L(i),n=U[i]||"Unknown";t.push({codon:i,anticodon:e,aminoAcid:n})}}return{codons:t,incomplete:null}}function D(e){return{A:"Adenine",T:"Thymine",U:"Uracil",C:"Cytosine",G:"Guanine"}[e]||e}function M(e){let t="";for(let n=0;n<e.length;n++){t+=D(e[n]),n<e.length-1&&(t+=", ")}return t}function b(){let n=t.val(),i=["DNA_COMPLEMENT","DNA_TRANSCRIPT","DNA_PROTEIN"].includes(n)?p:G;r.empty();for(let t=0;t<i.length;t++){let n=$('<button class="base-btn">'+i[t]+"</button>");n.on("click",(function(){let t=this.textContent;e.val(e.val()+t),y()})),r.append(n)}}function k(){let t=0==e.val().length;c.prop("disabled",t),s.prop("disabled",t)}e.tooltip({content:"Enter DNA or RNA sequence (only A, T, G, C, U characters allowed)",position:{my:"left+10 center",at:"right center"}}),e.on("focus",(function(){$(this).addClass("highlight-effect")})).on("blur",(function(){$(this).removeClass("highlight-effect")})),e.on("input",y),t.on("change",(function(){b(),y()})),n.on("change",y),i.on("change",y),c.on("click",(function(){let t=e.val();t.length>0&&(e.val(t.slice(0,-1)),y())})),s.on("click",(function(){e.val(""),y(),e.focus()})),a.on("click",(function(){let e=l.text();e?navigator.clipboard.writeText(e).then((function(){alert("Results copied to clipboard!")})).catch((function(e){E("Failed to copy results."),console.error("Copy failed:",e)})):E("No results to copy.")})),A.on("click",(function(){e.val(""),t.val("DNA_COMPLEMENT"),n.prop("checked",!0),i.prop("checked",!0),l.html(""),u.hide(),F(),b(),k(),e.focus()})),b(),k()}));