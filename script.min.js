document.addEventListener("DOMContentLoaded",(function(){let e=$("#sequence"),n=$("#conversionType"),t=$("#showBaseNames"),i=$("#colorizeSequence"),o=$("#result"),l=$("#error"),c=$("#base-buttons"),r=$("#delete-last"),s=$("#clear-all"),a=$("#copy-results"),A=$("#reset-all"),d=$("#visualizer-container"),u=$("#visualizer-title"),C=$(".amino-acid-tooltip"),h=document.getElementById("sequence-visualizer"),f=h.getContext("2d"),p=["A","T","G","C"],m=["A","U","G","C"],G=["DNA_COMPLEMENT","RNA_COMPLEMENT","DNA_TRANSCRIPT"],g={UUU:"Phenylalanine",UUC:"Phenylalanine",UUA:"Leucine",UUG:"Leucine",CUU:"Leucine",CUC:"Leucine",CUA:"Leucine",CUG:"Leucine",AUU:"Isoleucine",AUC:"Isoleucine",AUA:"Isoleucine",AUG:"Methionine",GUU:"Valine",GUC:"Valine",GUA:"Valine",GUG:"Valine",UCU:"Serine",UCC:"Serine",UCA:"Serine",UCG:"Serine",CCU:"Proline",CCC:"Proline",CCA:"Proline",CCG:"Proline",ACU:"Threonine",ACC:"Threonine",ACA:"Threonine",ACG:"Threonine",GCU:"Alanine",GCC:"Alanine",GCA:"Alanine",GCG:"Alanine",UAU:"Tyrosine",UAC:"Tyrosine",UAA:"Stop",UAG:"Stop",CAU:"Histidine",CAC:"Histidine",CAA:"Glutamine",CAG:"Glutamine",AAU:"Asparagine",AAC:"Asparagine",AAA:"Lysine",AAG:"Lysine",GAU:"Aspartic Acid",GAC:"Aspartic Acid",GAA:"Glutamic Acid",GAG:"Glutamic Acid",UGU:"Cysteine",UGC:"Cysteine",UGA:"Stop",UGG:"Tryptophan",CGU:"Arginine",CGC:"Arginine",CGA:"Arginine",CGG:"Arginine",AGU:"Serine",AGC:"Serine",AGA:"Arginine",AGG:"Arginine",GGU:"Glycine",GGC:"Glycine",GGA:"Glycine",GGG:"Glycine"};function U(e,n){d.hide(),f.clearRect(0,0,h.width,h.height);let t,i=Math.min(40*e.length+40,window.innerWidth-40),o=n.includes("PROTEIN")?150:180,l=window.devicePixelRatio||1;h.style.width=i+"px",h.style.height=o+"px",h.width=i*l,h.height=o*l,f.scale(l,l),t="RNA_PROTEIN"==n?e:"DNA_PROTEIN"==n?x(e):null,n.includes("PROTEIN")?function(e,n,t,i){u.text("Polypeptide Chain Visualization");let o=25,l=60,c=i+o,r=t/2,s={Alanine:"#FF6B6B",Arginine:"#4ECDC4",Asparagine:"#1A936F","Aspartic Acid":"#6A0572",Cysteine:"#FFD166","Glutamic Acid":"#118AB2",Glutamine:"#073B4C",Glycine:"#EF476F",Histidine:"#FFD166",Isoleucine:"#06D6A0",Leucine:"#7209B7",Lysine:"#3A86FF",Methionine:"#FB5607",Phenylalanine:"#8338EC",Proline:"#3A86FF",Serine:"#FF006E",Threonine:"#FFBE0B",Tryptophan:"#8AC926",Tyrosine:"#FF9E00",Valine:"#4361EE"},a=[];for(let n=0;n<e.length;n+=3){let t=e.slice(n,n+3);if(3==t.length){let e=g[t]||"Unknown";if("Stop"==e)break;a.push({codon:t,aminoAcid:e,color:s[e.split(" ")[0]]||"#6C757D",x:c+a.length*l,y:r})}}f.beginPath();for(let e=0;e<a.length-1;e++){let n=a[e],t=a[e+1];f.moveTo(n.x+o,n.y),f.lineTo(t.x-o,t.y)}function A(e){let n=h.getBoundingClientRect(),t=e.clientX-n.left,i=e.clientY-n.top,l=!1;for(let n of a){if(Math.sqrt((t-n.x)**2+(i-n.y)**2)<o){C.text(n.aminoAcid+" ("+n.codon+")").css({left:e.pageX+10,top:e.pageY-30,display:"block"}),l=!0;break}}l||C.hide()}function d(){C.hide()}f.strokeStyle="#495057",f.lineWidth=2,f.stroke(),h.removeEventListener("mousemove",A),h.removeEventListener("mouseout",d),h.addEventListener("mousemove",A),h.addEventListener("mouseout",d);for(let e of a){let{x:n,y:t,color:i,aminoAcid:l}=e;f.beginPath(),f.arc(n,t,o,0,2*Math.PI),f.fillStyle=i,f.fill(),f.strokeStyle="#343A40",f.lineWidth=1,f.stroke();let c=l.substring(0,3);f.fillStyle="#FFFFFF",f.font="bold 12px Noto Sans",f.textAlign="center",f.textBaseline="middle",f.fillText(c,n,t)}}(t,0,o,20):function(e,n,t,i,o){let l=40,c=20,r=i/2;u.text("Antiparallel Strands Visualization"),T(e,o,r-40,l,c,"top",n);let s="";"DNA_COMPLEMENT"==n?s=L(e):"RNA_COMPLEMENT"==n?s=F(e):"DNA_TRANSCRIPT"==n&&(s=x(e));T(s,o,r+40,l,c,"bottom",n);for(let n=0;n<e.length;n++){let e=o+n*l+l/2;f.beginPath(),f.moveTo(e,r-40+c),f.lineTo(e,r+40),f.strokeStyle="#CED4DA",f.lineWidth=1,f.stroke()}f.fillStyle="#6C757D",f.font="12px Noto Sans",f.textAlign="center",f.textBaseline="middle"}(e,n,0,o,20),d.show()}function T(e,n,t,i,o,l,c){let r="top"==l;for(let l=0;l<e.length;l++){let s=n+l*i,a=t,A=e[l];f.fillStyle=N(A,c),f.fillRect(s,a,i,o),f.strokeStyle="#343A40",f.lineWidth=1,f.strokeRect(s,a,i,o),f.fillStyle="#FFFFFF",f.font="bold 14px Noto Sans",f.textAlign="center",f.textBaseline="middle",f.fillText(A,s+i/2,a+o/2),f.beginPath(),f.moveTo(s,a+(r?0:o)),f.lineTo(s+i,a+(r?0:o)),f.strokeStyle="#495057",f.lineWidth=3,f.stroke()}}function N(e,n){return{A:"#FF6B6B",T:"#4ECDC4",U:"#1A936F",G:"#FFD166",C:"#6A0572"}[e]||"#6C757D"}function y(){P();let l=e.val().trim().toUpperCase(),c=n.val(),r=t.is(":checked"),s=i.is(":checked");(function(e,n){P();let t=/^[ATGC]*$/i,i=/^[AUGC]*$/i,l=!0,c="";if(""==e)return o.html(""),!0;"RNA_PROTEIN"==n||"RNA_COMPLEMENT"==n?i.test(e)||(l=!1,c="Invalid RNA sequence. Only A, U, G, C characters are allowed."):t.test(e)||(l=!1,c="Invalid DNA sequence. Only A, T, G, C characters are allowed.");if(!l)return E(c),!1;return!0})(l,c)&&(l?U(l,c):d.hide(),G.includes(c)?function(e,n,t,i){let l=function(e,n){if("DNA_COMPLEMENT"==n)return L(e);if("RNA_COMPLEMENT"==n)return F(e);if("DNA_TRANSCRIPT"==n)return x(e);return""}(e,n),c="<p><strong>"+function(e){return{DNA_COMPLEMENT:"Complement DNA",RNA_COMPLEMENT:"Complement RNA",DNA_TRANSCRIPT:"RNA Transcript"}[e]||""}(n)+":</strong> ";if(i){c+='<span class="sequence-container">';for(let e=0;e<l.length;e++){let n=l[e];c+='<span class="base-'+n.toLowerCase()+'">'+n+"</span>"}c+="</span>"}else c+=l;c+="</p>",t&&(c+="<p><strong>Input Bases:</strong> "+M(e)+"</p>",c+="<p><strong>Output Bases:</strong> "+M(l)+"</p>");o.html(c)}(l,c,r,s):function(e,n,t,i){let l,c,r="";if("RNA_PROTEIN"==n){let n=I(e);l=n.codons,c=n.incomplete}else{let n=I(x(e));l=n.codons,c=n.incomplete}if(l.length>0){r="<table><tr><th>Codon</th><th>tRNA Anticodon</th><th>Amino Acid</th></tr>";for(let e=0;e<l.length;e++){let n=l[e],t=n.codon,o=n.anticodon,c=n.aminoAcid,s=t,a=o;i&&(s=v(t),a=v(o)),r+="<tr><td>"+s+"</td><td>"+a+"</td><td><strong>"+c+"</strong></td></tr>"}r+="</table>",c&&(r+="<p><strong>Incomplete codon:</strong> "+c+"</p>"),t&&(r+="<p><strong>Input Bases:</strong> "+M(e)+"</p>"),o.html(r)}else E("No complete codons found.")}(l,c,r,s),b())}function E(e){l.text(e).fadeIn(200).addClass("error-shake"),setTimeout((function(){l.removeClass("error-shake")}),500),o.hide()}function P(){l.hide().text(""),o.show()}function v(e){let n="";for(let t=0;t<e.length;t++){let i=e[t];n+='<span class="base-'+i.toLowerCase()+'">'+i+"</span>"}return n}function L(e){let n={A:"T",T:"A",C:"G",G:"C"},t="";for(let i=0;i<e.length;i++){let o=e[i];t+=n[o]||o}return t}function F(e){let n={A:"U",U:"A",C:"G",G:"C"},t="";for(let i=0;i<e.length;i++){let o=e[i];t+=n[o]||o}return t}function x(e){let n={A:"U",T:"A",C:"G",G:"C"},t="";for(let i=0;i<e.length;i++){let o=e[i];t+=n[o]||o}return t}function R(e){let n={A:"U",U:"A",G:"C",C:"G"},t="";for(let i=e.length-1;i>=0;i--){let o=e[i];t+=n[o]||o}return t}function I(e){let n=[];for(let t=0;t<e.length;t+=3){let i=e.slice(t,t+3);if(3!=i.length)return{codons:n,incomplete:i};{let e=R(i),t=g[i]||"Unknown";n.push({codon:i,anticodon:e,aminoAcid:t})}}return{codons:n,incomplete:null}}function w(e){return{A:"Adenine",T:"Thymine",U:"Uracil",C:"Cytosine",G:"Guanine"}[e]||e}function M(e){let n="";for(let t=0;t<e.length;t++){n+=w(e[t]),t<e.length-1&&(n+=", ")}return n}function S(){let t=n.val(),i=["DNA_COMPLEMENT","DNA_TRANSCRIPT","DNA_PROTEIN"].includes(t)?p:m;c.empty();for(let n=0;n<i.length;n++){let t=$('<button class="base-btn">'+i[n]+"</button>");t.on("click",(function(){let n=this.textContent;e.val(e.val()+n),y()})),c.append(t)}}function b(){let n=0==e.val().length;r.prop("disabled",n),s.prop("disabled",n)}e.tooltip({content:"Enter DNA or RNA sequence (only A, T, G, C, U characters allowed)",position:{my:"left+10 center",at:"right center"}}),e.on("focus",(function(){$(this).addClass("highlight-effect")})).on("blur",(function(){$(this).removeClass("highlight-effect")})),e.on("input",y),n.on("change",(function(){S(),y()})),t.on("change",y),i.on("change",y),r.on("click",(function(){let n=e.val();n.length>0&&(e.val(n.slice(0,-1)),y())})),s.on("click",(function(){e.val(""),y(),e.focus()})),a.on("click",(function(){let e=o.text();e?navigator.clipboard.writeText(e).then((function(){alert("Results copied to clipboard!")})).catch((function(e){E("Failed to copy results."),console.error("Copy failed:",e)})):E("No results to copy.")})),A.on("click",(function(){e.val(""),n.val("DNA_COMPLEMENT"),t.prop("checked",!0),i.prop("checked",!0),o.html(""),d.hide(),P(),S(),b(),e.focus()})),S(),b()})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("minimize-button"),n=document.getElementById("maximize-button"),t=document.getElementById("close-button");e.addEventListener("click",(function(){window.electronAPI.minimizeWindow()})),n.addEventListener("click",(function(){window.electronAPI.toggleMaximizeWindow()})),t.addEventListener("click",(function(){window.electronAPI.closeWindow()})),window.electronAPI.onMaximize((function(){n.classList.add("maximized")})),window.electronAPI.onUnmaximize((function(){n.classList.remove("maximized")})),n.classList.contains("maximized")?n.classList.add("maximized"):n.classList.remove("maximized")}));